<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Interactive Art</title>
  <link href="bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h2>aquarium</h2>
    <p>
      水槽をクリックすると魚が増えます。<br />
      壁にぶつかると音がなって向きが変わります。
    </p>
    <canvas id="mycanvas" width="600" height="300">
      Canvasに対応したブラウザをご用意ください。
    </canvas>
    <div class="">
      <button id="resetTank">リセット</button>
      <button id="addFish">魚を追加</button>
      <button id="removeFish">魚を除去</button>
      <button id="addGrass">水草を追加</button>
      <button id="removeGrass">水草を除去</button>
    </div>
  </div>
  <audio id="fishTurn" preload="auto">
    <source src="fishTurn.mp3" type="audio/mp3">
    <p>※お使いのブラウザでは音は鳴りません。</p>
  </audio>
  <script>
  (function() {
    'use strict';

    var canvas;
    var ctx;
    var Fish;
    var fishes = [];
    var Grass;
    var grasses = [];
    var addFish = document.getElementById("addFish");
    var removeFish = document.getElementById("removeFish");
    var resetTank = document.getElementById("resetTank");

    canvas = document.getElementById('mycanvas');
    if (!canvas || !canvas.getContext) return false;
    ctx = canvas.getContext('2d');

    function rand(min, max) {
      // 0-n
      // Math.floor(Math.randam() * (n + 1))
      //min-max
      return min + Math.floor(Math.random() * (max - min + 1));
    }

    function ring() {
      var sound = document.getElementById("fishTurn");
      sound.load();
      sound.play();
    }

    canvas.addEventListener('click', function(e) {
      var x, y, s;
      var rect;
      // x = rand(100, 400);
      // y = rand(100, 400);
      rect = e.target.getBoundingClientRect();
      x = e.clientX - rect.left;
      y = e.clientY - rect.top;
      s = rand(0, 40) < 20 ? rand(30, 40) : rand(15, 20);
      if (x + s * 2 > canvas.width) {
        x = canvas.width - s * 2;
      }
      if (x - s * 2 < 0) {
        x = s * 2;
      }
      if (y + s > canvas.height * 0.9) {
        y = canvas.height * 0.9 - s * 0.7;
      } else if (y - s < 0) {
        y = s;
      }
      fishes.push(new Fish(x, y, s));
    });

    addFish.addEventListener('click', function() {
      var x, y, s;
      x = 100;
      y = 100;
      s = rand(0, 40) < 20 ? rand(30, 40) : rand(15, 20);
      fishes.push(new Fish(x, y, s));
    });

    addGrass.addEventListener('click', function() {
      var x, y, s;
      x = rand(0, canvas.width - 15);
      y = canvas.height * 0.9;
      s = rand(0, 30) < 20 ? rand(20, 30) : rand(10, 15);
      grasses.push(new Grass(x, y, s));
    });

    removeFish.addEventListener('click', function() {
      var x, y, s;
      x = 100;
      y = 100;
      s = rand(0, 60) < 20 ? rand(40, 60) : rand(10, 20);
      fishes.shift();
    });
    resetTank.addEventListener('click', function() {
      fishes = [];
      grasses = [];
    });

    Grass = function(x, y, s){
      this.x = x;
      this.y = y;
      this.s = s;
      this.color_h = rand(110, 130);
      this.color_s = rand(40, 60);
      this.color_l = rand(40, 60);
      this.color_a = 0.7;
      this.color = 'hsla(' + this.color_h + ', ' + this.color_s + '%, ' + this.color_l + '%, ' + this.color_a + ')';
      this.draw = function() {
        // for (i = 0; i < grasses.length; i++){
          // grasses[i].draw();
        // }
        ctx.beginPath();
        ctx.moveTo(this.x, this.y);
        ctx.lineTo(this.x, this.y - this.s);
        ctx.lineWidth = 3;
        ctx.strokeStyle = this.color;
        ctx.stroke();
        ctx.closePath();
        ctx.beginPath();
        ctx.moveTo(this.x + 5, this.y);
        ctx.lineTo(this.x + 5, this.y - this.s);
        ctx.lineWidth = 3;
        ctx.strokeStyle = this.color;
        ctx.stroke();
        ctx.closePath();
        ctx.beginPath();
        ctx.moveTo(this.x + 10, this.y);
        ctx.lineTo(this.x + 10, this.y - this.s);
        ctx.lineWidth = 3;
        ctx.strokeStyle = this.color;
        ctx.stroke();
        ctx.closePath();
        ctx.beginPath();
        ctx.moveTo(this.x + 15, this.y);
        ctx.lineTo(this.x + 15, this.y - this.s);
        ctx.lineWidth = 3;
        ctx.strokeStyle = this.color;
        ctx.stroke();
        ctx.closePath();
        ctx.beginPath();
        ctx.moveTo(this.x + 20, this.y);
        ctx.lineTo(this.x + 20, this.y - this.s);
        ctx.lineWidth = 3;
        ctx.strokeStyle = this.color;
        ctx.stroke();
        ctx.closePath();

        // ctx.beginPath();
        // ctx.moveTo(this.x + 3, this.y);
        // ctx.lineTo(this.x + 3, this.y - this.s);
        // ctx.lineWidth = 1;
        // ctx.strokeStyle = this.color;
        // ctx.stroke();
        // ctx.closePath();
        // ctx.beginPath();
        // ctx.moveTo(this.x + 6, this.y);
        // ctx.lineTo(this.x + 6, this.y - this.s);
        // ctx.lineWidth = 1;
        // ctx.strokeStyle = this.color;
        // ctx.stroke();
        // ctx.closePath();
      }
    }

    Fish = function(x, y, s) {
      var color_h, color_s, color_l, color_a;
      this.x = x;
      this.y = y;
      this.s = s;
      this.vx = rand(-10, 10);
      this.vy = rand(-10, 10);
      this.color_h = rand(200, 220);
      this.color_s = rand(80, 100);
      this.color_l = rand(40, 60);
      this.color_a = 1;
      this.color = 'hsla(' + this.color_h + ', ' + this.color_s + '%, ' + this.color_l + '%, ' + this.color_a + ')';
      this.draw = function() {
        // ctx.beginPath();
        // ctx.moveTo(this.x, this.y);
        // ctx.lineTo(this.s, this.s);
        // ctx.stroke();
        if(this.vx < 0) {
          ctx.beginPath();
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x + this.s * 2, this.y - this.s * 0.7);
          ctx.lineTo(this.x + this.s * 2, this.y + this.s * 0.7);
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x - this.s, this.y + this.s * 0.7);
          ctx.lineTo(this.x - this.s * 2, this.y);
          ctx.lineTo(this.x - this.s, this.y - this.s * 0.7);
          ctx.fillStyle = this.color;
          ctx.closePath();
          ctx.fill();
          ctx.beginPath();
          ctx.arc(this.x - this.s * 1.3, this.y - this.s * 0.1, this.s / 10, 0, Math.PI*2);
          ctx.strokeStyle = "white";
          ctx.lineWidth = this.s / 40;
          ctx.closePath();
          ctx.stroke();
        }
        if(this.vx > 0) {
          ctx.beginPath();
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x - this.s * 2, this.y - this.s * 0.7);
          ctx.lineTo(this.x - this.s * 2, this.y + this.s * 0.7);
          ctx.moveTo(this.x, this.y);
          ctx.lineTo(this.x + this.s, this.y + this.s * 0.7);
          ctx.lineTo(this.x + this.s * 2, this.y);
          ctx.lineTo(this.x + this.s, this.y - this.s * 0.7);
          ctx.fillStyle = this.color;
          ctx.closePath();
          ctx.fill();
          ctx.beginPath();
          ctx.arc(this.x + this.s * 1.3, this.y - this.s * 0.1, this.s / 7, 0, Math.PI*2);
          ctx.strokeStyle = "white";
          ctx.lineWidth = this.s / 40;
          ctx.closePath();
          ctx.stroke();
        }
      };
      this.move = function() {
        if (this.x + this.s * 2 > canvas.width || this.x - this.s * 2 < 0){
          this.vx *= -1;
          ring();
        }
        if (this.y + this.s * 0.7 > canvas.height * 0.9 || this.y - this.s * 0.7 < 0){
          this.vy *= -1;
        }
        this.x += this.vx;
        this.y += this.vy;
      }
    };



    var fish = new Fish(rand(100, 200), rand(100, 200), rand(10, 50));
    fish.draw();

    function update() {
      var i;
      ctx.fillStyle = '#0099ff'
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#333'
      ctx.fillRect(0, canvas.height * 0.9, canvas.width, canvas.height);
      for (i = 0; i < grasses.length; i++){
        grasses[i].draw();
      }
      for (i = 0; i < fishes.length; i++){
        fishes[i].draw();
        fishes[i].move();
      }
      setTimeout(function() {
        update();
      }, 20);
    }

    update();

  })();



  </script>

</body>
</html>
